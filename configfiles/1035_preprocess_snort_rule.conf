# Author: Justin Henderson
#         SANS Instructor and author of SANS SEC555: SIEM and Tactical Analytics
# Updated by: Doug Burks
# Last Update: 3/15/2018

# This was previously in 1033_preprocess_snort.conf.
# However, it can hurt performance if one or more of the following conditions is true:
# - lots of NIDS alerts
# - spinny drives (instead of SSD)
#
# Therefore, we're moving this out to a separate file so it can more easily be disabled if necessary.

filter {
  if [type] == "snort" {
    if [gid] and [gid] == 1 and [sid] and [sid] > 0 and [sid] < 1000000000 {
      ruby {
         code => "sid = event.get('sid'); event.set('rule', `grep -h sid:#{sid} /etc/nsm/rules/*.rules | sort -u`)"
        }
    }
}
